var xt=Object.defineProperty;var vt=(e,o,t)=>o in e?xt(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var W=(e,o,t)=>vt(e,typeof o!="symbol"?o+"":o,t);import{t as gt,a as wt}from"../chunks/DGsgRh_C.js";import{i as yt}from"../chunks/e2UX8lEO.js";import{z as st,p as Mt,k as bt,t as Tt,m as Yt,a0 as Xt,g as c,a1 as _,a2 as Z,a3 as E,s as y,n as I,o as D,a4 as kt}from"../chunks/BWsCOVV9.js";import{e as O,s as N}from"../chunks/B53XRLZL.js";import{b as Pt}from"../chunks/Dh-oV1Fs.js";import{o as Lt}from"../chunks/BPfKqZ70.js";const rt=[...` 	
\r\fÂ \v\uFEFF`];function Ct(e,o,t){var n=""+e;if(t){for(var a in t)if(t[a])n=n?n+" "+a:a;else if(n.length)for(var i=a.length,s=0;(s=n.indexOf(a,s))>=0;){var l=s+i;(s===0||rt.includes(n[s-1]))&&(l===n.length||rt.includes(n[l]))?n=(s===0?"":n.substring(0,s))+n.substring(l+1):s=l}}return n===""?null:n}function F(e,o,t,n,a,i){var s=e.__className;if(st||s!==t||s===void 0){var l=Ct(t,n,i);(!st||l!==e.getAttribute("class"))&&(l==null?e.removeAttribute("class"):e.className=l),e.__className=t}else if(i&&a!==i)for(var h in i){var d=!!i[h];(a==null||d!==!!a[h])&&e.classList.toggle(h,d)}return i}class it{constructor(o,t,n,a,i){this.x=o,this.a=t,this.b=n,this.c=a,this.d=i}getIndex(o){if(o<this.x[0]||o>this.x[this.x.length-1]||Number.isNaN(o))return 0;{let t=0;for(;!(this.x[t]<=o&&o<=this.x[t+1]);)t++;return t}}compute(o){if(this.x.length<2||o<this.x[0]||o>this.x[this.x.length-1])return 0;let t=this.getIndex(o);return Math.pow(o,3)*this.a[t]+Math.pow(o,2)*this.b[t]+o*this.c[t]+this.d[t]}computeComponent(o,t){return Math.pow(o,3)*this.a[t]+Math.pow(o,2)*this.b[t]+o*this.c[t]+this.d[t]}computeDerivative(o){if(this.x.length<2||o<this.x[0]||o>this.x[this.x.length-1])return 0;let t=this.getIndex(o);return 3*Math.pow(o,2)*this.a[t]+2*o*this.b[t]+this.c[t]}computeSecondDerivative(o){if(this.x.length<2||o<this.x[0]||o>this.x[this.x.length-1])return 0;let t=this.getIndex(o);return 6*o*this.a[t]+2*this.b[t]}getMaxSecondDerivative(){let o=0;for(let t=0;t<this.x.length;t++)o=Math.max(this.computeSecondDerivative(this.x[t]),o);return o}computeIntegral(){let o=0;for(let t=0;t<this.x.length-1;t++){let n=this.x[t],a=this.x[t+1];o+=(a-n)/6*(this.compute(n)+4*this.compute((n+a)/2)+this.compute(a))}return o}}const At=e=>{const o=[...e].sort((r,m)=>r.x-m.x),t=o.length;if(t<2)return new it(o.map(r=>r.x),[],[],[],[]);const n=t-1,a=o.map(r=>r.x),i=new Array(n),s=new Array(n);for(let r=0;r<n;r++)i[r]=o[r+1].x-o[r].x,s[r]=(o[r+1].y-o[r].y)/i[r];const l=new Array(t).fill(0),h=new Array(t).fill(0);if(n>1){l[1]=2*(i[0]+i[1]),h[1]=6*(s[1]-s[0]);for(let r=2;r<n;r++){const m=i[r-1]/l[r-1];l[r]=2*(i[r-1]+i[r])-i[r-1]*m,h[r]=6*(s[r]-s[r-1])-h[r-1]*m}}const d=new Array(t).fill(0);for(let r=n-1;r>=1;r--)d[r]=(h[r]-i[r]*d[r+1])/l[r];const x=new Array(n),M=new Array(n),b=new Array(n),Y=new Array(n);for(let r=0;r<n;r++){const m=(d[r+1]-d[r])/(6*i[r]),p=d[r]/2,L=s[r]-i[r]*(2*d[r]+d[r+1])/6,A=o[r].y,v=a[r];x[r]=m,M[r]=-3*m*v+p,b[r]=3*m*v*v-2*p*v+L,Y[r]=-m*v*v*v+p*v*v-L*v+A}return new it(a,x,M,b,Y)},St=(e,o,t,n)=>{const a=t*n(o,e),i=t*n(o+1/2*t,e+1/2*a),s=t*n(o=1/2*t,e+1/2*i),l=t*n(o+t,e+s);return e+1/6*(a+2*i+2*s+l)},V=(e,o,t)=>(t(e+o)-t(e-o))/(2*o),_t=(e,o)=>{let t=[];for(let n=0;n<e.x.length-1;n++)t.push(...It(e.a[n],e.b[n],e.c[n],e.d[n]-o,e.x[n],e.x[n+1]));return t},It=(e,o,t,n,a,i)=>{let s=[],l=Math.pow(2*o,2)-12*e*t;l===0?s.push(-2*o/(6*e)):l>0&&(s.push((-2*o+Math.sqrt(l))/(6*e)),s.push((-2*o-Math.sqrt(l))/(6*e)));let h=[a,...s.filter(x=>a<x&&x<i),i],d=[];for(let x=0;x<h.length-1;x++){let M=h[x],b=h[x+1];R(e*Math.pow(M,3)+o*Math.pow(M,2)+t*M+n)!==R(e*Math.pow(b,3)+o*Math.pow(b,2)+t*b+n)&&d.push(Dt(Y=>e*Math.pow(Y,3)+o*Math.pow(Y,2)+t*Y+n,.001,M,b))}return d},Dt=(e,o,t,n)=>{let a=t,i=n,s=(a+i)/2;for(;i-a>o;){if(R(e(s))===1)return s;R(e(s))===R(e(a))?a=s:i=s,s=(a+i)/2}return s},R=e=>e<0?2:e>0?0:1,qt=(e,o,t)=>{let n=new Array(o).fill(0);for(let a=0;a<o;a++){let i=0;for(let s=0;s<a;s++)i+=n[s]*e[a][s];n[a]=1/e[a][a]*(t[a]-i)}return n},Wt=(e,o,t)=>{let n=new Array(o).fill(0);for(let a=0;a<o;a++){let i=0;for(let s=0;s<a;s++)i+=n[o-1-s]*e[o-1-a][o-1-s];n[o-1-a]=1/e[o-1-a][o-1-a]*(t[o-1-a]-i)}return n};class u{constructor(o,t){this.x=o,this.y=t}}class q{constructor(o){this.entries=o}multiplyVector(o){let t=[0,0,0];for(let n=0;n<3;n++)for(let a=0;a<3;a++)t[n]+=this.entries[n][a]*o[a];return t}transformPoint(o){let t=this.multiplyVector([o.x,o.y,1]);return new u(t[0],t[1])}inverseTransform(o){let t=[[1,0,0],[0,1,0],[0,0,1]],n=this.entries.map(l=>[...l]);for(let l=0;l<2;l++)for(let h=l+1;h<3;h++){let d=n[h][l]/n[l][l];t[h][l]=d;for(let x=0;x<3;x++)n[h][x]-=d*n[l][x]}console.debug(t,n);let a=[o.x,o.y,1],i=qt(t,3,a),s=Wt(n,3,i);return new u(s[0],s[1])}multiply(o){let t=new q([[0,0,0],[0,0,0],[0,0,0]]);for(let n=0;n<3;n++)for(let a=0;a<3;a++)for(let i=0;i<3;i++)t.entries[n][a]+=this.entries[n][i]*o.entries[i][a];return t}}const Zt=(e,o)=>new q([[1,0,e],[0,1,o],[0,0,1]]),ct=e=>new q([[e,0,0],[0,e,0],[0,0,1]]),Et=()=>new q([[1,0,0],[0,-1,0],[0,0,1]]),Rt=()=>{console.log(ct(3).inverseTransform(new u(1,1)))};class Nt{constructor(o){W(this,"topLeftX");W(this,"topLeftY");W(this,"zoom");W(this,"coordinates");this.canvas=o,this.topLeftX=0,this.topLeftY=0,this.zoom=1,this.coordinates=new q([]),this.updateCoordinates()}updateCoordinates(){this.coordinates=ct(this.zoom).multiply(Zt(this.topLeftX,this.topLeftY)).multiply(Et())}transformPoint(o){return this.coordinates.transformPoint(o)}transformX(o){return this.coordinates.transformPoint(new u(o,0)).x}transformY(o){return this.coordinates.transformPoint(new u(0,o)).y}inverseTransformPoint(o){return this.coordinates.inverseTransform(o)}inverseTransformX(o){return this.coordinates.inverseTransform(new u(o,0)).x}inverseTransformY(o){return this.coordinates.inverseTransform(new u(0,o)).y}getTopLeft(){return new u(this.topLeftX,this.topLeftY)}updateTopLeft(o){this.topLeftX=o.x,this.topLeftY=o.y,this.updateCoordinates()}getZoom(){return this.zoom}updateZoom(o){this.zoom=o,this.updateCoordinates()}}class jt{constructor(o,t,n){this.camera=o,this.context=t,this.canvas=n}}const Kt=(e,o,t)=>{for(let n=t.x[0];n<t.x[t.x.length-1];n+=o*2)e.context.beginPath(),e.context.strokeStyle="#ffe1a3",e.context.lineWidth=5,e.context.moveTo(e.camera.transformX(n),e.camera.transformY(0)),e.context.lineTo(e.camera.transformX(n),e.camera.transformY(t.compute(n))),e.context.stroke();for(let n=0;n<e.canvas.height;n+=o*2){let a=_t(t,n);for(let i=0;i<a.length-1;i++){let[s,l]=[a[i],a[i+1]];t.computeDerivative(s)>0&&(e.context.beginPath(),e.context.moveTo(e.camera.transformX(s),e.camera.transformY(t.compute(s))),e.context.lineTo(e.camera.transformX(l),e.camera.transformY(t.compute(l))),e.context.stroke())}if(a.length>0){let i=a[a.length-1];t.computeDerivative(i)>0&&(e.context.beginPath(),e.context.moveTo(e.camera.transformX(i),e.camera.transformY(t.compute(i))),e.context.lineTo(e.camera.transformX(t.x[t.x.length-1]),e.camera.transformY(t.compute(i))),e.context.stroke())}}for(let n=t.x[0];n<t.x[t.x.length-1];n+=o)e.context.beginPath(),e.context.strokeStyle="#808080",e.context.lineWidth=5,e.context.moveTo(e.camera.transformX(n),e.camera.transformY(t.compute(n))),e.context.lineTo(e.camera.transformX(n+o),e.camera.transformY(t.compute(n+o))),e.context.stroke()},Gt=(e,o,t)=>{e.context.beginPath(),e.context.fillStyle="black";let n=t.compute(o),a=20;e.context.translate(e.camera.transformX(o),e.camera.transformY(n)),e.context.rotate(-Math.atan(t.computeDerivative(o))),e.context.fillRect(-20,-20,2*a,a),e.context.translate(e.camera.transformX(-o),e.camera.transformY(-n)),e.context.fill(),e.context.resetTransform()},Bt=(e,o,t)=>{for(let n=0;n<o.length;n++){let a=o[n];e.context.beginPath(),e.context.fillStyle=t===n?"#606060":"#808080",e.context.arc(e.camera.transformX(a.x),e.camera.transformY(a.y),t===n?15:10,0,2*Math.PI),e.context.fill()}},Ht=(e,o,t,n)=>{let a=t.getIndex(n);for(let i=-e.canvas.width*5;i<e.canvas.width*4;i+=o)e.context.beginPath(),e.context.strokeStyle="#c44cfc",e.context.lineWidth=5,e.context.moveTo(e.camera.transformX(i),e.camera.transformY(t.computeComponent(i,a))),e.context.lineTo(e.camera.transformX(i+o),e.camera.transformY(t.computeComponent(i+o,a))),e.context.stroke()},lt=(e,o,t)=>{e.context.beginPath(),e.context.moveTo(e.camera.transformX(o.x),e.camera.transformY(o.y)),e.context.lineTo(e.camera.transformX(t.x),e.camera.transformY(t.y));let n=Math.atan2(t.y-o.y,t.x-o.x),a=Math.sqrt(Math.pow(t.y-o.y,2)+Math.pow(t.x-o.x,2));e.context.moveTo(e.camera.transformX(t.x),e.camera.transformY(t.y)),e.context.lineTo(e.camera.transformX(t.x+Math.cos(n+Math.PI*4/5)*a/3),e.camera.transformY(t.y+Math.sin(n+Math.PI*4/5)*a/3)),e.context.moveTo(e.camera.transformX(t.x),e.camera.transformY(t.y)),e.context.lineTo(e.camera.transformX(t.x+Math.cos(n-Math.PI*4/5)*a/3),e.camera.transformY(t.y+Math.sin(n-Math.PI*4/5)*a/3)),e.context.stroke()},$t=(e,o,t,n)=>{e.context.lineWidth=5;let a=Math.atan(o),i=-Math.sin(a)*60,s=Math.cos(a)*60;e.context.strokeStyle="#4c66fc",lt(e,new u(t,n),new u(t+Math.cos(a)*i,n+Math.sin(a)*i)),e.context.strokeStyle="#fc9b4c",lt(e,new u(t,n),new u(t+Math.cos(a-Math.PI/2)*s,n+Math.sin(a-Math.PI/2)*s))};var Ot=gt('<canvas class="svelte-1n97v8e"></canvas> <div class="info svelte-1n97v8e"><p><strong class="underline">Total area of your coaster</strong> <br> </p> <p><strong class="underline">Current coaster speed</strong> <br> </p> <p><strong class="underline">Current coaster acceleration</strong> <br> </p> <p><strong class="underline">Current coaster jerk</strong> <br> </p> <p><button>Toggle component drawing</button> <button>Toggle forces</button> <button>Toggle follow</button></p> <strong class="underline">Controls</strong> <ul><li>- Place knot: <code class="svelte-1n97v8e">Left Click</code></li> <li>- Move knot: Hold <code class="svelte-1n97v8e">Left Click</code></li> <li>- Clear tracks: <code class="svelte-1n97v8e">Backspace/Delete</code></li> <li>- Re-place coaster: <code class="svelte-1n97v8e">P</code></li> <li>- Pan camera: hold <code class="svelte-1n97v8e">Shift</code></li> THESE TWO ARE REALLY BUGGY: <li>- Zoom camera out: <code class="svelte-1n97v8e">-</code></li> <li>- Zoom camera in: <code class="svelte-1n97v8e">+</code></li></ul></div>',1);function ee(e,o){Mt(o,!1);let t=_(),n,a=[],i={x:0},s=-1,l=!1,h,d=_(),x=_(),M=_(),b=_(),Y,r=.01,m,p=_({components:!1,forces:!1,follow:!1});const L=()=>100/window.innerWidth,A=()=>{h=At(a),E(d,h.computeIntegral()*L())};Lt(()=>{Rt(),n=c(t).getContext("2d"),m=new Nt(c(t)),m.updateTopLeft(new u(0,window.innerHeight*4/5)),window.addEventListener("keydown",f=>{f.key==="Shift"?l=!0:f.key==="Backspace"?(a=[new u(0,0),new u(window.innerWidth,0)],A()):f.key==="p"?r=m.inverseTransformX(i.x):f.key==="+"?m.updateZoom(m.getZoom()*1.1):f.key==="-"&&m.updateZoom(m.getZoom()/1.1)}),window.addEventListener("keyup",f=>{f.key==="Shift"&&(l=!1)}),c(t).addEventListener("mousedown",f=>{let g=m.inverseTransformX(f.clientX),X=m.inverseTransformY(f.clientY),S=!1;for(let T=0;T<a.length;T++){const k=a[T];if(Math.hypot(k.x-g,k.y-X)<=10){s=T,S=!0;break}}S||(a.push(new u(g,X)),A())}),c(t).addEventListener("mousemove",f=>{if(i={x:f.clientX,y:f.clientY},s!==-1){if(a[s].x=m.inverseTransformX(f.clientX),a[s].y=m.inverseTransformY(f.clientY),s+1<a.length&&a[s].x>a[s+1].x){let g=a[s];a[s]=a[s+1],a[s+1]=g,s+=1}if(s-1>=0&&a[s].x<a[s-1].x){let g=a[s];a[s]=a[s-1],a[s-1]=g,s-=1}A()}if(l){console.log("DRAGGING");let g=m.getTopLeft();m.updateTopLeft(new u(g.x+f.movementX/m.getZoom(),g.y+f.movementY/m.getZoom()))}}),c(t).addEventListener("mouseup",f=>{s!=-1&&(s=-1)}),a.push(new u(c(t).clientWidth*.1,0)),a.push(new u(c(t).clientWidth*.9,0)),A(),J(0)});let v=0;const J=f=>{let g=f-v;v=f,Z(t,c(t).width=c(t).clientWidth),Z(t,c(t).height=c(t).clientHeight),n.fillStyle="skyblue",n.fillRect(0,0,c(t).width,c(t).height);let X=30,S=(w,P)=>{let dt=X*Math.sqrt(Math.max(0,c(t).height*2/3-h.compute(P))),pt=Math.atan(h.computeDerivative(P));return Math.cos(pt)*dt};Y=X*Math.sqrt(c(t).height*2/3-h.compute(r)),E(M,V(r,.001,w=>X*Math.sqrt(c(t).height*2/3-h.compute(w))*L()/1.467)*60),E(b,V(r,.001,w=>V(w,.001,P=>X*Math.sqrt(c(t).height*2/3-h.compute(P))*L()/1.467)*60)*60),r=St(r,0,g/1e3,S);let T=a.map(w=>w.x).reduce((w,P)=>Math.min(w,P)),k=a.map(w=>w.x).reduce((w,P)=>Math.max(w,P));r<T&&(r+=k-T),r>k&&(r-=k-T),c(p).follow&&m.updateTopLeft(new u(-r+c(t).width/2,m.getTopLeft().y));let C=new jt(m,n,c(t));Kt(C,10,h),c(p).components&&Ht(C,10,h,r),Bt(C,a,s),Gt(C,r,h),c(p).forces&&$t(C,h.computeDerivative(r),r,h.compute(r)),E(x,Y*L()/1.467),requestAnimationFrame(J)};yt();var U=Ot(),Q=bt(U);Pt(Q,f=>E(t,f),()=>c(t));var z=y(Q,2),j=I(z),ht=y(I(j),3);D(j);var K=y(j,2),mt=y(I(K),3);D(K);var G=y(K,2),ft=y(I(G),3);D(G);var B=y(G,2),ut=y(I(B),3);D(B);var tt=y(B,2),H=I(tt);let et;var $=y(H,2);let ot;var nt=y($,2);let at;D(tt),kt(4),D(z),Tt((f,g,X,S,T,k,C)=>{N(ht,` ${f??""} square feet.`),N(mt,` ${g??""} miles per hour.`),N(ft,` ${X??""} miles per hour per second.`),N(ut,` ${S??""} miles per hour per second per second.`),et=F(H,1,"svelte-1n97v8e",null,et,T),ot=F($,1,"svelte-1n97v8e",null,ot,k),at=F(nt,1,"svelte-1n97v8e",null,at,C)},[()=>Math.round(c(d)),()=>Math.round(c(x)),()=>Math.round(c(M)),()=>Math.round(c(b)),()=>({"button-selected":c(p).components}),()=>({"button-selected":c(p).forces}),()=>({"button-selected":c(p).follow})],Xt),O("click",H,()=>Z(p,c(p).components=!c(p).components)),O("click",$,()=>Z(p,c(p).forces=!c(p).forces)),O("click",nt,()=>Z(p,c(p).follow=!c(p).follow)),wt(e,U),Yt()}export{ee as component};
